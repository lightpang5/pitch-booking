# 📝 업데이트 내역 (Update History)

## [2026-02-20] 예약 및 게스트 초대 로직 점검 및 개선

**개요:** 예약 생성, 변경 및 게스트 초대 로직을 전반적으로 점검하고, 발견된 문제점들을 수정하여 안정성을 높였습니다. 상세 분석 결과 및 조치 사항은 다음과 같습니다.

---

### 🚀 1. 주요 수정 사항

#### A. 알림 메시지 날짜 포맷팅 개선
* **기존 문제:** 서버 액션에서 `toLocaleString()`을 사용하고 있어, 서버의 시간대(Timezone) 설정에 따라 사용자에게 잘못된 시간이 표시될 위험이 존재했습니다.
* **수정 조치:** `date-fns` 라이브러리를 도입하여 한국어(`ko` locale) 및 고정된 포맷(`yyyy년 MM월 dd일 HH:mm`)으로 메시지가 안전하게 생성되도록 수정했습니다.
* **적용 파일:** * `src/app/actions/booking.ts`
  * `src/app/actions/update-booking.ts`

#### B. 게스트 초대 누락 알림 추가
* **기존 문제:** `updateBooking` 실행 시, 초대하려는 게스트가 서비스에 가입되지 않은 이메일일 경우 아무런 알림 없이 초대가 조용히 생략되는 문제가 있었습니다.
* **수정 조치:** `createBooking`과 동일하게, 가입되지 않은 친구 수만큼 경고(Warning) 메시지를 반환하도록 예외 처리 로직을 보강했습니다.
* **결과:** 사용자에게 *"N명의 친구를 찾을 수 없었습니다 (가입 여부 확인 필요)"* 라는 명확한 피드백 메시지가 전달됩니다.

#### C. 예약 변경 시 알림 로직 점검 및 개선
* **로직 점검:** 시간이 변경된 경우에만 기존 참가자들에게 "경기 시간 변경" 알림이 발송되도록 설계된 조건문을 확인 및 검증했습니다.
* **메시지 개선:** 새롭게 추가된 게스트에게는 시간 변경 여부와 상관없이 항상 초대 알림이 발송되는 것을 확인하였으며, 사용자 경험을 위해 알림 메시지 포맷을 더 정중하고 명확하게 다듬었습니다.

---

### 🔍 2. 점검 결과 및 제언

* **실제 이메일 전송 서비스 부재:** 현재 프로젝트에는 `Resend`나 `Nodemailer`와 같은 실제 외부 이메일 발송 API가 연동되어 있지 않습니다. 현재의 "초대 메일"은 시스템 내부의 `notifications`(알림) 테이블에 기록되어 앱 내 대시보드에만 표시되는 방식입니다. 사용자의 실제 이메일 수신함으로 메일을 발송하려면 외부 서비스 연동이 필수적입니다.
* **E2E 테스트 검증:** Playwright를 활용하여 UI 흐름(다이얼로그 열기 ➔ 시간 선택 ➔ 저장)이 정상적으로 동작함을 확인했습니다. 서버 로직 대폭 수정 후에도 기본적인 예약 변경 흐름은 완벽하게 작동합니다.

---

### 💡 3. 향후 권장 사항 (Next Steps)

1. **실제 이메일 API 연동:** `Resend` 등의 이메일 발송 서비스를 도입하여, 실제 게스트의 이메일로 예쁘게 디자인된 초대장(HTML 메일)을 발송하면 사용자 경험(UX)이 비약적으로 상승할 것입니다.
2. **비회원 섀도우(Shadow) 초대 처리:** 현재는 서비스에 가입된 사용자만 초대할 수 있습니다. 비회원 이메일이 입력될 경우, 상태를 '초대 대기'로 임시 저장하고 해당 이메일로 **"PITCH-Booking 가입 및 경기 수락 링크"**를 보내는 기능을 추가하여 신규 유저 유입(Viral)을 유도하는 것을 강력히 권장합니다.